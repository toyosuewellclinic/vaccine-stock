<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ãƒ¯ã‚¯ãƒãƒ³åœ¨åº«</title>
<style>
*{box-sizing:border-box}
body{margin:8px;padding:0;font-family:sans-serif}
#vsw .upd{font-size:12px;color:#888;text-align:right;margin-bottom:12px}
#vsw .dot{display:inline-block;width:7px;height:7px;border-radius:50%;background:#27ae60;margin-right:4px;vertical-align:middle}
#vsw h3{font-size:15px;font-weight:bold;margin:20px 0 6px;padding:6px 12px;border-left:4px solid #0066cc;background:#f0f4f8;color:#1a2332}
#vsw table{width:100%;border-collapse:collapse;font-size:13px;margin-bottom:8px}
#vsw th{background:#f0f4f8;padding:7px 10px;text-align:left;font-weight:bold;border:1px solid #dde4ec;color:#333}
#vsw td{padding:7px 10px;border:1px solid #dde4ec;vertical-align:middle;word-break:break-all}
#vsw tr:nth-child(even) td{background:#f8fafc}
#vsw .q{text-align:center;font-weight:bold;font-size:14px;white-space:nowrap;min-width:50px}
#vsw .q.out{color:#c0392b}
#vsw .q.low{color:#e67e22}
#vsw .q.ok{color:#27ae60}
</style>
</head>
<body>
<div id="vsw"><p style="color:#888">â³ åœ¨åº«æƒ…å ±ã‚’èª­ã¿è¾¼ã¿ä¸­...</p></div>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script>
!function(){
  var cfg={apiKey:'AIzaSyAbUBYMYfKoQmBuPZVfCjjtBfZ0SoWTgMU',authDomain:'clinic-inventory-c2207.firebaseapp.com',projectId:'clinic-inventory-c2207',storageBucket:'clinic-inventory-c2207.firebasestorage.app',messagingSenderId:'609898487561',appId:'1:609898487561:web:6388126fef0c9672803dd8'};
  var app;
  try{app=firebase.app('vsw');}catch(e){app=firebase.initializeApp(cfg,'vsw');}
  var db=firebase.firestore(app);
  var DOM=[
    {n:'ãŠãŸãµããƒ¯ã‚¯ãƒãƒ³',p:'6,600å††(ç¨è¾¼)'},
    {n:'å›½ç”£Aå‹è‚ç‚ãƒ¯ã‚¯ãƒãƒ³(ã‚¨ã‚¤ãƒ ã‚²ãƒ³)',p:'8,800å††(ç¨è¾¼)'},
    {n:'ç ´å‚·é¢¨ãƒˆã‚­ã‚½ã‚¤ãƒ‰',p:'3,800å††(ç¨è¾¼)'},
    {n:'3ç¨®æ··åˆ(DPT)ãƒ¯ã‚¯ãƒãƒ³(ãƒˆãƒªãƒ“ãƒƒã‚¯)',p:'5,500å††(ç¨è¾¼)'},
    {n:'å¸¯çŠ¶ç–±ç–¹ãƒ¯ã‚¯ãƒãƒ³(ã‚·ãƒ³ã‚°ãƒªãƒƒã‚¯ã‚¹)',p:'22,000å††(ç¨è¾¼)'},
    {n:'è‚ºç‚çƒèŒãƒ¯ã‚¯ãƒãƒ³(ãƒ‹ãƒ¥ãƒ¼ãƒ¢ãƒãƒƒã‚¯ã‚¹)',p:'8,500å††(ç¨è¾¼)'},
    {n:'æ°´ç—˜ãƒ»å¸¯çŠ¶ç–±ç–¹ãƒ¯ã‚¯ãƒãƒ³ï¼ˆç”Ÿãƒ¯ã‚¯ãƒãƒ³ï¼‰',p:'8,400å††(ç¨è¾¼)'},
    {n:'MRãƒ¯ã‚¯ãƒãƒ³(ãƒŸãƒ¼ãƒ«ãƒ“ãƒƒã‚¯)',p:'8,800å††(ç¨è¾¼)'},
    {n:'å›½ç”£Bå‹è‚ç‚ãƒ¯ã‚¯ãƒãƒ³(ãƒ“ãƒ¼ãƒ ã‚²ãƒ³)',p:'3,500å††(ç¨è¾¼)'}
  ];
  var IMP=[
    {n:'è¼¸å…¥è…¸ãƒãƒ•ã‚¹ãƒ¯ã‚¯ãƒãƒ³(Typbar TCV)',p:'11,000å††(ç¨è¾¼)'},
    {n:'è¼¸å…¥ç‹‚çŠ¬ç—…ãƒ¯ã‚¯ãƒãƒ³(ChiroRab)',p:'14,800å††(ç¨è¾¼)'},
    {n:'è¼¸å…¥Aå‹è‚ç‚ãƒ¯ã‚¯ãƒãƒ³(Havrix)',p:'8,800å††(ç¨è¾¼)'},
    {n:'è¼¸å…¥ã‚³ãƒ¬ãƒ©ãƒ¯ã‚¯ãƒãƒ³(DUKORAL)',p:'12,000å††(ç¨è¾¼)'},
    {n:'è¼¸å…¥3ç¨®æ··åˆãƒ¯ã‚¯ãƒãƒ³ï¼ˆBoostrixï¼‰',p:'5,500å††(ç¨è¾¼)'},
    {n:'è¼¸å…¥æ—¥æœ¬è„³ç‚ãƒ¯ã‚¯ãƒãƒ³(JENVAC)',p:'6,600å††(ç¨è¾¼)'},
    {n:'è¼¸å…¥Aå‹Bå‹è‚ç‚ãƒ¯ã‚¯ãƒãƒ³(Twinrix)',p:'17,600å††(ç¨è¾¼)'}
  ];
  function row(c,map){
    var pd=map[c.n],q='<span style="color:#bbb">ï¼</span>',cls='';
    if(pd){
      if(pd.stock===0){cls='out';q='çµ‚äº†';}
      else if(pd.stock<pd.minStock){cls='low';q=pd.stock+' '+(pd.unit||'å€‹');}
      else{cls='ok';q=pd.stock+' '+(pd.unit||'å€‹');}
    }
    return '<tr><td>'+c.n+'</td><td class="q '+cls+'">'+q+'</td><td>'+c.p+'</td></tr>';
  }
  function tbl(list,map){
    var r='';
    for(var i=0;i<list.length;i++)r+=row(list[i],map);
    return '<table><thead><tr><th>ç¨®é¡</th><th style="text-align:center">åœ¨åº«</th><th>ä¾¡æ ¼</th></tr></thead><tbody>'+r+'</tbody></table>';
  }
  var w=document.getElementById('vsw');
  db.collection('products').where('category','==','ãƒ¯ã‚¯ãƒãƒ³').get().then(function(snap){
    var map={};
    snap.forEach(function(doc){var d=doc.data();map[d.name]=d;});
    var dt=new Date().toLocaleDateString('ja-JP',{year:'numeric',month:'long',day:'numeric',hour:'2-digit',minute:'2-digit'})+' æ›´æ–°';
    w.innerHTML='<div class="upd"><span class="dot"></span>'+dt+'</div>'
      +'<h3>ğŸ‡¯ğŸ‡µ å›½ç”£ãƒ¯ã‚¯ãƒãƒ³</h3>'+tbl(DOM,map)
      +'<h3>âœˆï¸ è¼¸å…¥ãƒ¯ã‚¯ãƒãƒ³</h3>'+tbl(IMP,map);
    // è¦ªãƒšãƒ¼ã‚¸ã«ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®é«˜ã•ã‚’é€šçŸ¥
    window.parent.postMessage({iframeHeight: document.body.scrollHeight + 20}, '*');
  }).catch(function(err){
    w.innerHTML='<p style="color:red">âš ï¸ èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: '+err.message+'</p>';
  });
}();
</script>
</body>
</html>
